/*
jQuery UI Virtual Keyboard Widget
Version 1.5.3 minified

Author: Jeremy Satterfield
Modified: Rob G (Mottie on github)
-----------------------------------------
Creative Commons Attribution-Share Alike 3.0 Unported License
http://creativecommons.org/licenses/by-sa/3.0/
-----------------------------------------
*/

(function(b){b.widget("ui.keyboard",{layouts:{alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}", "{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |", 'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {alt} {cancel}"],alt:["~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}","{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{accept} {space} {alt} {cancel}"],"alt-shift":["~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}", "{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}","{accept} {space} {alt} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |', "A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 . {a} {c}"]}},options:{layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top"},display:{a:"\u2714",accept:"Accept",alt:"AltGr",b:"\u2190",bksp:"Bksp",c:"\u2716",cancel:"Cancel",clear:"C",e:"\u21b5",enter:"Enter",s:"\u21e7",shift:"Shift",sign:"\u00b1",space:"Space",t:"\u21e5",tab:"\u21e5 Tab"}, wheelMessage:"Use mousewheel to see other keys",actionClass:"ui-state-active",lockInput:false,keyBinding:"mousedown",useCombos:true,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd",c:"\u00e7",C:"\u00c7"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6", u:"\u00fc",U:"\u00dc"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db"},"~":{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",n:"\u00f1",N:"\u00d1"}},accepted:null,canceled:null,hidden:null,visible:null},shiftActive:false,altActive:false,metaActive:false,rows:["ui-keyboard-keyset-default","ui-keyboard-keyset-shift","ui-keyboard-keyset-alt","ui-keyboard-keyset-alt-shift"], _init:function(){var a=this,c=a.options,d=a.element;b.isFunction(c.visible)&&d.bind("visible",c.visible);b.isFunction(c.hidden)&&d.bind("hidden",c.hidden);b.isFunction(c.canceled)&&d.bind("canceled",c.canceled);b.isFunction(c.accepted)&&d.bind("accepted",c.accepted);b(document).bind("mousedown keyup",function(g){a._escClose(g,a)});d.addClass("ui-keyboard-input ui-widget-content ui-corner-all").attr({"aria-haspopup":"true",role:"textbox"}).bind("focus",function(){typeof a.keyboard=="undefined"&&a._startup(); var g=b(this),l=a.keyboard.find(".ui-keyboard-preview").val(g.val());a.keyboard.css({position:"absolute",left:0,top:0}).show().position({of:c.position.of||g.data("keyboardPosition")||g,my:c.position.my,at:c.position.at,collision:"fit"});g.trigger("visible",g);l.trigger("gotoEnd");a._checkDecimal(a.keyboard.find(".ui-keyboard-decimal"))})},_startup:function(){var a=this,c=a.options,d=a._buildKeyboard(),g=d.find(".ui-keyboard-button"),l=d.find(".ui-keyboard-preview"),o=d.find(".ui-keyboard-decimal"), m=b.isFunction(b.fn.mousewheel);a.keyboard=d;l.bind("keyup gotoEnd",function(){b(this).scrollTop(l.attr("scrollHeight")).focus()});b("body").append(d);g.bind(c.keyBinding,function(){var j=b.data(this,"key"),n=l.val();if(b.isFunction(j.action))j.action(this);else if(typeof j.action!=="undefined"){if(j.action=="bksp")n=n.substring(0,n.length-1);else n+=m&&!b(this).is(".ui-keyboard-actionkey")?j.curTxt:j.action;if(c.useCombos)n=a._checkCombos(n);l.val(n)}l.trigger("gotoEnd")}).bind("mouseenter mouseleave mousewheel", function(j,n){var e=b(this),h,f=b.data(this,"key");if(j.type=="mouseenter")e.addClass("ui-state-hover").attr("title",m?c.wheelMessage:"");else if(j.type=="mouseleave"){f.curTxt=f.original;f.curNum=0;b.data(this,"key",f);e.removeClass("ui-state-hover").removeAttr("title").val(f.original)}else if(m){h=f.layers||a._getLayers(e);f.curNum+=n>0?-1:1;if(f.curNum>h.length-1)f.curNum=0;if(f.curNum<0)f.curNum=h.length-1;f.layers=h;f.curTxt=h[f.curNum];b.data(this,"key",f);e.val(h[f.curNum])}});o.length&&g.click(function(){a._checkDecimal(o)})}, _showKeySet:function(a){this.keyboard.find(".ui-keyboard-actionkey[name*=key_meta]").removeClass("ui-state-active");if(this.metaActive){a=a.name.split("_")[1];this.keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass("ui-state-active").end().find(".ui-keyboard-actionkey.ui-keyboard-"+a).addClass("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset-"+a).show()}else{a=this.shiftActive?1:0;a+=this.altActive?2:0; this.keyboard.find(".ui-keyboard-alt")[this.altActive?"addClass":"removeClass"]("ui-state-active").end().find(".ui-keyboard-shift")[this.shiftActive?"addClass":"removeClass"]("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find("."+this.rows[a]).show()}},_checkCombos:function(a){var c=this.options;return a=a.replace(/([`\'~\^\"a])([a-z])/ig,function(d,g,l){return g in c.combos?c.combos[g][l]||d:d})},_checkDecimal:function(a){/\./.test(a.closest(".ui-keyboard").find(".ui-keyboard-preview").val())? a.attr({disabled:"disabled","aria-disabled":"true"}).removeClass("ui-state-default ui-state-hover").addClass("ui-state-disabled"):a.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass("ui-state-default").removeClass("ui-state-disabled")},_getLayers:function(a){var c;c=a.attr("name");return a.closest(".ui-keyboard").find("input[name="+c+"]").map(function(){return this.value}).get()},_hide:function(a){if(typeof this.keyboard!="undefined"){var c=this.keyboard.filter(":visible").length;this.keyboard.hide(); this.element.scrollTop(this.element.attr("scrollHeight"));if(c){this.element.trigger(typeof a!=="undefined"&&a?"accepted":"canceled",this.element);this.element.trigger("hidden",this.element)}}},_escClose:function(a,c){if(a.which==27||a.type=="mousedown"&&b(a.target).closest(".ui-keyboard").length<1)c._hide()},_buildKeyboard:function(){var a,c,d,g,l,o,m,j,n,e=this,h=e.options,f=b("<div />").addClass("ui-keyboard ui-widget-content ui-widget ui-corner-all ui-helper-clearfix ui-helper-hidden-accessible").attr({role:"textbox"}).hide(), p=e.element.clone().removeAttr("id").show().attr(h.lockInput?{readonly:"readonly"}:{}).addClass("ui-widget-content ui-keyboard-preview ui-corner-all").bind("keyup",function(){h.useCombos&&b(this).val(e._checkCombos(b(this).val()))}),t=b("<input />").attr({type:"button",role:"button","aria-disabled":"false"}).addClass("ui-keyboard-button ui-state-default ui-corner-all"),k=function(i,q,u,r){q=r===true?i:h.display[q]||i;var s=q.length>1?" ui-keyboard-widekey":"";s+=r!==true?" ui-keyboard-actionkey": "";return t.clone().attr("name","key_"+i).data("key",{action:u,original:q,curTxt:q,curNum:0}).val(q).addClass("ui-keyboard-"+(r===true?i.charCodeAt(0):i)+s)};b("<div />").append(p).appendTo(f);if(h.layout=="custom")e.layouts.custom=h.customLayout||{"default":["{cancel}"]};h.display.decimal=".";for(g in e.layouts[h.layout]){j=e.layouts[h.layout][g];l=b("<div />").addClass("ui-keyboard-keyset ui-keyboard-keyset-"+g).appendTo(f)[g=="default"?"show":"hide"]();for(c in j){d=b("<div />").addClass("ui-keyboard-row ui-keyboard-row"+ c).appendTo(l);a=b.trim(j[c]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");m=a.split(/\s+/);for(o in m)if(m[o].length!==0)if(/^\{\S+\}$/.test(m[o])){a=m[o].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/^sp:(\.?\d+)$/.test(a)){n=a.match(/^sp:(\.?\d+)$/)[1]||0;b("<span>&nbsp;</span>").css("margin","0 "+n+"em").appendTo(d)}if(/^meta\d+$/.test(a))k(a,a,function(i){e.metaActive=b(i).is(".ui-state-active")?false:true;e._showKeySet(i)}).appendTo(d);else switch(a){case "a":case "accept":k("accept",a,function(){var i= p.val();if(h.useCombos)i=e._checkCombos(p.val());e.element.val(i);e._hide(true)}).addClass(h.actionClass).appendTo(d);break;case "alt":case "altgr":k("alt","alt",function(i){e.altActive=!e.altActive;e.metaActive=false;e._showKeySet(i)}).appendTo(d);break;case "b":case "bksp":k("bksp",a,"bksp").appendTo(d);break;case "c":case "cancel":k("cancel",a,function(){e._hide()}).addClass(h.actionClass).appendTo(d);break;case "clear":k("clear","clear",function(){p.val("")}).appendTo(d);break;case "dec":k("decimal", "decimal",".").appendTo(d);break;case "e":case "enter":k("enter",a,"\n").appendTo(d);break;case "s":case "shift":k("shift",a,function(i){e.shiftActive=!e.shiftActive;e.metaActive=false;e._showKeySet(i)}).appendTo(d);break;case "sign":k("sign","sign",function(){/^\-?\d*\.?\d*$/.test(p.val())&&p.val(p.val()*-1)}).appendTo(d);break;case "space":k("space","space"," ").appendTo(d);break;case "t":case "tab":k("tab",a,"\t").appendTo(d)}}else k(m[o],m[o],m[o],true).attr("name","key_"+c+"_"+o).appendTo(d)}}return f}, destroy:function(){this.element.removeClass("ui-keyboard-input ui-widget-content ui-corner-all").removeAttr("aria-haspopup").removeAttr("role").unbind("focus accept canceled hidden visible");this.keyboard.remove();b(document).unbind("mousedown keyup",this._escClose);b.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
