/*
jQuery UI Virtual Keyboard Widget
Version 1.5.2 minified

Author: Jeremy Satterfield
Modified: Rob G (Mottie on github)
-----------------------------------------
Creative Commons Attribution-Share Alike 3.0 Unported License
http://creativecommons.org/licenses/by-sa/3.0/
-----------------------------------------
*/

(function(c){c.widget("ui.keyboard",{layouts:{alpha:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}"],["a b c d e f g h i j [ ] \\","A B C D E F G H I J { } |"],["k l m n o p q r s ; ' {enter}",'K L M N O P Q R S : " {enter}'],["{shift} t u v w x y z , . / {shift}","{shift} T U V W X Y Z < > ? {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],qwerty:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}"],["{tab} q w e r t y u i o p [ ] \\", "{tab} Q W E R T Y U I O P { } |"],["a s d f g h j k l ; ' {enter}",'A S D F G H J K L : " {enter}'],["{shift} z x c v b n m , . / {shift}","{shift} Z X C V B N M < > ? {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],international:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}","~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}"], ["{tab} q w e r t y u i o p [ ] \\","{tab} Q W E R T Y U I O P { } |","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6"],["a s d f g h j k l ; ' {enter}",'A S D F G H J K L : " {enter}',"\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}"],["{shift} z x c v b n m , . / {shift}","{shift} Z X C V B N M < > ? {shift}", "{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}"],["{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}"]],dvorak:[["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","~ ! @ # $ % ^ & * ( ) { } {bksp}"],["{tab} ' , . p y f g c r l / = \\",'{tab} " < > P Y F G C R L ? + |'],["a o e u i d h t n s - {enter}","A O E U I D H T N S _ {enter}"],["{shift} ; q j k x b m w v z {shift}", "{shift} : Q J K X B M W V Z {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],num:[["= ( ) {b}"],["{clear} / * -"],["7 8 9 +"],["4 5 6 {sign}"],["1 2 3 %"],["0 . {a} {c}"]]},options:{layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top"},display:{a:"\u2714",accept:"Accept",alt:"AltGr",b:"\u2190",bksp:"Bksp",c:"\u2716",cancel:"Cancel",clear:"C",e:"\u21b5",enter:"Enter",s:"\u21e7",shift:"Shift",sign:"\u00b1",space:"Space",t:"\u21e5",tab:"\u21e5 Tab"}, wheelMessage:"Use mousewheel to see other keys",actionClass:"ui-state-active",lockInput:false,keyBinding:"mousedown",accepted:null,canceled:null,hidden:null,visible:null,useCombos:true,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd",c:"\u00e7",C:"\u00c7"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb", E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db"},"~":{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",n:"\u00f1",N:"\u00d1"}}},shiftActive:false,altActive:false,_init:function(){var a=this,b=a.options,f=a.element;c.isFunction(b.visible)&&f.bind("visible",b.visible);c.isFunction(b.hidden)&&f.bind("hidden", b.hidden);c.isFunction(b.canceled)&&f.bind("canceled",b.canceled);c.isFunction(b.accepted)&&f.bind("accepted",b.accepted);c(document).bind("mousedown keyup",function(j){a._escClose(j,a)});f.addClass("ui-keyboard-input ui-widget-content ui-corner-all").attr({"aria-haspopup":"true",role:"textbox"}).bind("focus",function(){typeof a.keyboard=="undefined"&&a._startup();var j=c(this),k=a.keyboard.find(".ui-keyboard-preview").val(j.val());a.keyboard.css({position:"absolute",left:0,top:0}).show().position({of:b.position.of|| j,my:b.position.my,at:b.position.at,collision:"fit"});j.trigger("visible",j);k.trigger("gotoEnd");a._checkDecimal(a.keyboard.find(".ui-keyboard-decimal"))})},_startup:function(){var a=this,b=a.options,f=a._buildKeyboard(),j=f.find(".ui-keyboard-button"),k=f.find(".ui-keyboard-preview"),i=f.find(".ui-keyboard-decimal"),l=c.isFunction(c.fn.mousewheel);a.keyboard=f;k.bind("keyup gotoEnd",function(){c(this).scrollTop(k.attr("scrollHeight")).focus()});c("body").append(f);j.bind(b.keyBinding,function(){var g= c.data(this,"key"),m=k.val();if(c.isFunction(g.action))g.action(a);else if(typeof g.action!=="undefined"){if(g.action=="bksp")m=m.substring(0,m.length-1);else m+=l&&!c(this).is(".ui-keyboard-actionkey")?g.curTxt:g.action;if(b.useCombos)m=a._checkCombos(m);k.val(m)}k.trigger("gotoEnd")}).bind("mouseenter mouseleave mousewheel",function(g,m){var d=c(this),h,e=c.data(this,"key");if(g.type=="mouseenter")d.addClass("ui-state-hover").attr("title",l?b.wheelMessage:"");else if(g.type=="mouseleave"){e.curTxt= e.original;e.curNum=0;c.data(this,"key",e);d.removeClass("ui-state-hover").removeAttr("title").val(e.original)}else if(l){h=e.layers||a._getLayers(d);e.curNum+=m>0?-1:1;if(e.curNum>h.length-1)e.curNum=0;if(e.curNum<0)e.curNum=h.length-1;e.layers=h;e.curTxt=h[e.curNum];c.data(this,"key",e);d.val(h[e.curNum])}});i.length&&j.click(function(){a._checkDecimal(i)})},_checkCombos:function(a){var b=this.options;return a=a.replace(/([`\'~\^\"a])([a-z])/ig,function(f,j,k){return j in b.combos?b.combos[j][k]|| f:f})},_checkDecimal:function(a){/\./.test(a.closest(".ui-keyboard").find(".ui-keyboard-preview").val())?a.attr({disabled:"disabled","aria-disabled":"true"}).removeClass("ui-state-default ui-state-hover").addClass("ui-state-disabled"):a.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass("ui-state-default").removeClass("ui-state-disabled")},_getLayers:function(a){var b;b=a.attr("name").split("_");b=b[b.length-1]||"";return a.closest(".ui-keyboard-row").find(".ui-keyboard-button[name$=_"+ b+"]").map(function(){return this.value}).get()},_hide:function(a){if(typeof this.keyboard!="undefined"){var b=this.keyboard.filter(":visible").length;this.keyboard.hide();this.element.scrollTop(this.element.attr("scrollHeight"));if(b){this.element.trigger(typeof a!=="undefined"&&a?"accepted":"canceled",this.element);this.element.trigger("hidden",this.element)}}},_escClose:function(a,b){if(a.which==27||a.type=="mousedown"&&c(a.target).closest(".ui-keyboard").length<1)b._hide()},_buildKeyboard:function(){var a, b,f,j,k,i,l,g,m,d=this,h=d.options,e=c("<div />").addClass("ui-keyboard ui-widget-content ui-widget ui-corner-all ui-helper-clearfix ui-helper-hidden-accessible").attr({role:"textbox"}).hide(),q=d.element.clone().removeAttr("id").show().attr(h.lockInput?{readonly:"readonly"}:{}).addClass("ui-widget-content ui-keyboard-preview ui-corner-all").bind("keyup",function(){h.useCombos&&c(this).val(d._checkCombos(c(this).val()))}),u=c("<input />").attr({type:"button",role:"button","aria-disabled":"false"}).addClass("ui-keyboard-button ui-state-default ui-corner-all"), p=function(n,o,v,r){o=r===true?n:h.display[o]||n;var t=o.length>1?" ui-keyboard-widekey":"";t+=r!==true?" ui-keyboard-actionkey":"";return u.clone().attr("name","key_"+n).data("key",{action:v,original:o,curTxt:o,curNum:0}).val(o).addClass("ui-keyboard-"+(r===true?n.charCodeAt(0):n)+t)},s=["ui-keyboard-default","ui-keyboard-shifted","ui-keyboard-alted","ui-keyboard-altshift"];c("<div />").append(q).appendTo(e);if(h.layout=="custom")d.layouts.custom=h.customLayout||[["{cancel}"]];h.display.decimal= ".";for(b in d.layouts[h.layout]){f=d.layouts[h.layout][b];j=c("<div />").addClass("ui-keyboard-row ui-keyboard-row"+b).appendTo(e);for(k in f){i=c("<div />").addClass("ui-keyboard-keyset "+s[k]).appendTo(j)[k=="0"?"show":"hide"]();a=c.trim(f[k]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");g=a.split(/\s+/);for(l in g)if(g[l].length!==0)if(/^\{\S+\}$/.test(g[l])){a=g[l].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/^sp:(\.?\d+)$/.test(a)){m=a.match(/^sp:(\.?\d+)$/)[1]||0;c("<span>&nbsp;</span>").css("margin", "0 "+m+"em").appendTo(i)}switch(a){case "a":case "accept":p("accept",a,function(){var n=q.val();if(h.useCombos)n=d._checkCombos(q.val());d.element.val(n);d._hide(true)}).addClass(h.actionClass).appendTo(i);break;case "alt":case "altgr":p("alt","alt",function(){d.altActive=!d.altActive;var n=d.altActive?"addClass":"removeClass",o=d.shiftActive?1:0;o+=d.altActive?2:0;e.find(".ui-keyboard-alt")[n]("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find("."+s[o]).show()}).appendTo(i);break; case "b":case "bksp":p("bksp",a,"bksp").appendTo(i);break;case "c":case "cancel":p("cancel",a,function(){d._hide()}).addClass(h.actionClass).appendTo(i);break;case "clear":p("clear","clear",function(){q.val("")}).appendTo(i);break;case "dec":p("decimal","decimal",".").appendTo(i);break;case "e":case "enter":p("enter",a,"\n").appendTo(i);break;case "s":case "shift":p("shift",a,function(){d.shiftActive=!d.shiftActive;var n=d.shiftActive?"addClass":"removeClass",o=d.shiftActive?1:0;o+=d.altActive?2: 0;e.find(".ui-keyboard-shift")[n]("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find("."+s[o]).show()}).appendTo(i);break;case "sign":p("sign","sign",function(){/^\-?\d*\.?\d*$/.test(q.val())&&q.val(q.val()*-1)}).appendTo(i);break;case "space":p("space","space"," ").appendTo(i);break;case "t":case "tab":p("tab",a,"\t").appendTo(i)}}else p(g[l],g[l],g[l],true).attr("name","key_"+b+"_"+l).appendTo(i)}}return e},destroy:function(){this.element.removeClass("ui-keyboard-input ui-widget-content ui-corner-all").removeAttr("aria-haspopup").removeAttr("role").unbind("focus accept canceled hidden visible"); this.keyboard.remove();c(document).unbind("mousedown keyup",this._escClose);c.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);
