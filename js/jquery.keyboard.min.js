/*
jQuery UI Virtual Keyboard Widget
Version 1.4.2 minified

Author: Jeremy Satterfield
Modified: Rob G (Mottie on github)
-----------------------------------------
Creative Commons Attribution-Share Alike 3.0 Unported License
http://creativecommons.org/licenses/by-sa/3.0/
-----------------------------------------
*/

jQuery.widget("ui.keyboard",{layouts:{qwerty:[["1 2 3 4 5 6 7 8 9 0 - = `","! @ # $ % ^ & * ( ) _ + ~"],["q w e r t y u i o p [ ] \\","Q W E R T Y U I O P { } |"],["{sp:.5} a s d f g h j k l ; ' {return}",'{sp:.5} A S D F G H J K L : " {return}'],["{sp:1} z x c v b n m , . / {shift}","{sp:1} Z X C V B N M < > ? {shift}"],["{accept} {space} {cancel} {bksp}","{accept} {space} {cancel} {bksp}"]],alpha:[["1 2 3 4 5 6 7 8 9 0 - = `","! @ # $ % ^ & * ( ) _ + ~"],["a b c d e f g h i j [ ] \\","A B C D E F G H I J { } |"], ["{sp:.5} k l m n o p q r s ; ' {return}",'{sp:.5} K L M N O P Q R S : " {return}'],["{sp:1} t u v w x y z , . / {shift}","{sp:1} T U V W X Y Z < > ? {shift}"],["{accept} {space} {cancel} {bksp}","{accept} {space} {cancel} {bksp}"]],dvorak:[["1 2 3 4 5 6 7 8 9 0 [ ] `","! @ # $ % ^ & * ( ) { } ~"],["' , . p y f g c r l / = \\",'" < > P Y F G C R L ? + |'],["{sp:.5} a o e u i d h t n s - {return}","{sp:.5} A O E U I D H T N S _ {return}"],["{sp:1} ; q j k x b m w v z {shift}","{sp:1} : Q J K X B M W V Z {shift}"], ["{accept} {space} {cancel} {bksp}","{accept} {space} {cancel} {bksp}"]],num:[["1 2 3 {bksp}"],["4 5 6 {accept}"],["7 8 9 {cancel}"],["0 {dec} {neg}"]]},_init:function(){this.options.layout=this.options.layout||"qwerty";this.layouts.custom=this.options.customLayout||[["{cancel}"]];var i=this.element,f=this._buildKeyboard(this),d=f.find(".ui-keyboard-button"),j=d.filter(":not(.ui-keyboard-actionkey)"),g=f.find(".ui-keyboard-preview"),a=f.find("[name=key_decimal]");jQuery(document).unbind("mousedown", this._hideonexternalclick).bind("mousedown",this._hideonexternalclick);i.focus(function(){var b;b=jQuery(this);jQuery(".ui-keyboard").hide();g.val(b.val());b=jQuery.datepicker._checkOffset({dpDiv:f,settings:{isRTL:false}},b.offset(),false);f.css({position:"absolute",left:b.left+"px",top:b.top+"px"}).show();g.scrollTop(g.attr("scrollHeight")).focus()});jQuery("body").append(f);j.click(function(){g.val(g.val()+this.value)});d.click(function(){g.scrollTop(g.attr("scrollHeight")).focus()});a.length>0&& d.click(function(){/\./.test(g.val())?a.attr("disabled","disabled").removeClass("ui-state-default").addClass("ui-state-disabled"):a.removeAttr("disabled").addClass("ui-state-default").removeClass("ui-state-disabled")})},_hideonexternalclick:function(i){jQuery(i.target).closest(".ui-keyboard").length<1&&jQuery(".ui-keyboard").hide()},_buildKeyboard:function(i){var f,d,j,g,a,b,c,n,o,h=jQuery("<div></div>").addClass("ui-keyboard").addClass("ui-widget-content").addClass("ui-widget").hide(),e=i.element.clone().attr("name", "preview").attr("readonly","readonly").addClass("ui-state-active").addClass("ui-keyboard-preview");jQuery("<div></div>").append(e).appendTo(h);f=jQuery("<input />").attr("type","button").addClass("ui-keyboard-button").addClass("ui-state-default");d=f.clone().addClass("ui-keyboard-actionkey");var l,m,k;for(l in this.layouts[this.options.layout]){j=this.layouts[this.options.layout][l];g=jQuery("<div></div>").attr("id","ui-keyboard-row"+l).addClass("ui-keyboard-row").appendTo(h);for(m in j){a=jQuery("<div></div>").addClass("ui-keyboard-keyset").appendTo(g); m==1&&a.addClass("ui-keyboard-shiftset").hide();b=j[m];b=b.split(/\s+/);for(k in b)if(/^\{\S+\}$/.test(b[k])){c=b[k].match(/^\{(\S+)\}$/)[1];if(c=="space")d.clone().attr("name","key_space").val("Space").addClass("ui-keyboard-space").click(function(){e.val(e.val()+" ")}).appendTo(a);else if(c=="bksp")d.clone().attr("name","key_bksp").val("<Bksp").click(function(){e.val(e.val().substring(0,e.val().length-1))}).appendTo(a);else if(c=="shift")d.clone().attr("name","key_shift").val("Shift").click(function(){n= h.find(".ui-keyboard-keyset:hidden");o=h.find(".ui-keyboard-keyset:visible");o.hide();n.show()}).appendTo(a);else if(c=="accept")d.clone().attr("name","key_accept").val("Accept").addClass("ui-state-highlight").removeClass("ui-state-active").click(function(){i.element.val(e.val());h.hide()}).appendTo(a);else if(c=="cancel")d.clone().attr("name","key_cancel").val("Cancel").addClass("ui-state-highlight").removeClass("ui-state-active").click(function(){h.hide()}).appendTo(a);else if(/^sp:\.?\d+$/.test(c)){c= c.match(/^sp:(\.?\d+)$/)[1];jQuery("<span>&nbsp;</span>").css("margin","0 "+c+"em").appendTo(a)}else if(c=="dec")f.clone().attr("name","key_decimal").val(".").appendTo(a);else if(c=="neg")d.clone().attr("name","key_negative").val("+/-").click(function(){/^\-?\d*\.?\d*$/.test(e.val())&&e.val(e.val()*-1)}).appendTo(a);else c=="return"&&d.clone().attr("name","key_return").val("Return").click(function(){e.val(e.val()+" \n")}).appendTo(a)}else f.clone().attr("name","key_"+l+"_"+k).val(b[k]).appendTo(a)}}return h}});