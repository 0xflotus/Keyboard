/*
jQuery UI Virtual Keyboard Widget
Version 1.5 minified

Author: Jeremy Satterfield
Modified: Rob G (Mottie on github)
-----------------------------------------
Creative Commons Attribution-Share Alike 3.0 Unported License
http://creativecommons.org/licenses/by-sa/3.0/
-----------------------------------------
*/

(function(b){b.widget("ui.keyboard",{layouts:{alpha:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}"],["a b c d e f g h i j [ ] \\","A B C D E F G H I J { } |"],["k l m n o p q r s ; ' {enter}",'K L M N O P Q R S : " {enter}'],["{shift} t u v w x y z , . / {shift}","{shift} T U V W X Y Z < > ? {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],qwerty:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}"],["{tab} q w e r t y u i o p [ ] \\", "{tab} Q W E R T Y U I O P { } |"],["a s d f g h j k l ; ' {enter}",'A S D F G H J K L : " {enter}'],["{shift} z x c v b n m , . / {shift}","{shift} Z X C V B N M < > ? {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],international:[["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","~ ! @ # $ % ^ & * ( ) _ + {bksp}","~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}"], ["{tab} q w e r t y u i o p [ ] \\","{tab} Q W E R T Y U I O P { } |","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6"],["a s d f g h j k l ; ' {enter}",'A S D F G H J K L : " {enter}',"\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}"],["{shift} z x c v b n m , . / {shift}","{shift} Z X C V B N M < > ? {shift}", "{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}"],["{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}","{accept} {space} {alt} {cancel}"]],dvorak:[["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","~ ! @ # $ % ^ & * ( ) { } {bksp}"],["{tab} ' , . p y f g c r l / = \\",'{tab} " < > P Y F G C R L ? + |'],["a o e u i d h t n s - {enter}","A O E U I D H T N S _ {enter}"],["{shift} ; q j k x b m w v z {shift}", "{shift} : Q J K X B M W V Z {shift}"],["{accept} {space} {cancel}","{accept} {space} {cancel}"]],num:[["= ( ) {b}"],["{clear} / * -"],["7 8 9 +"],["4 5 6 {sign}"],["1 2 3 %"],["0 . {a} {c}"]]},options:{layout:"qwerty",customLayout:null,position:{my:"center top",at:"center top"},display:{a:"\u2714",accept:"Accept",alt:"AltGr",b:"\u2190",bksp:"Bksp",c:"\u2716",cancel:"Cancel",clear:"C",e:"\u21b5",enter:"Enter",s:"\u21e7",shift:"Shift",sign:"\u00b1",space:"Space",t:"\u21e5",tab:"\u21e5 Tab"},actionClass:"ui-state-active", lockInput:false,keyBinding:"mousedown",useCombos:true,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd",c:"\u00e7",C:"\u00c7"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca", i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db"},"~":{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",n:"\u00f1",N:"\u00d1"}}},shiftActive:false,altActive:false,_init:function(){var a=this,d=a.options,q=a.element,n=a._buildKeyboard(),p=n.find(".ui-keyboard-button"),e=n.find(".ui-keyboard-preview"),j=n.find(".ui-keyboard-decimal"),k=b.isFunction(b.fn.mousewheel);b(document).unbind("mousedown",a._hide).bind("mousedown keyup", function(f){if(f.which==27||(f.type="mousedown")&&b(f.target).closest(".ui-keyboard").length<1)a._hide()});q.addClass("ui-widget-content ui-corner-all").attr({"aria-haspopup":"true",role:"textbox"}).focus(function(){var f=b(this);b(".ui-keyboard").hide();e.val(f.val());n.css({position:"absolute",left:0,top:0}).show().position({of:b(this),my:d.position.my,at:d.position.at,collision:"fit"});e.trigger("gotoEnd");a._checkDecimal(j)});e.bind("keyup gotoEnd",function(){b(this).scrollTop(e.attr("scrollHeight")).focus()}); b("body").append(n);p.bind(d.keyBinding,function(){var f=b.data(this,"keyaction"),c=e.val();if(b.isFunction(f))f(a);else if(typeof f!=="undefined"){if(f=="bksp")c=c.substring(0,c.length-1);else c+=k&&!b(this).is(".ui-keyboard-actionkey")?b.data(this,"current")||f:f;if(d.useCombos)c=a._checkCombos(c);e.val(c)}e.trigger("gotoEnd")}).bind("mouseenter mouseleave mousewheel",function(f,c){var g=b(this),i,h;if(f.type=="mouseenter")g.addClass("ui-state-hover").attr("title",k?"Use mousewheel to see other options": "");else if(f.type=="mouseleave"){h=b.data(this,"original");b.data(this,"currentNum",0);b.data(this,"current",h);g.removeClass("ui-state-hover").removeAttr("title").val(h)}else if(k){i=b.data(this,"currentNum")||0;h=b.data(this,"layers")||a._getLayers(g);i+=c>0?-1:1;if(i>h.length-1)i=0;if(i<0)i=h.length-1;b.data(this,"currentNum",i);b.data(this,"current",h[i]);g.val(h[i])}});j.length&&p.click(function(){a._checkDecimal(j)})},_checkCombos:function(a){var d=this.options;return a=a.replace(/([`\'~\^\"a])([a-z])/ig, function(q,n,p){return n in d.combos?d.combos[n][p]||q:q})},_checkDecimal:function(a){/\./.test(a.closest(".ui-keyboard").find(".ui-keyboard-preview").val())?a.attr({disabled:"disabled","aria-disabled":"true"}).removeClass("ui-state-default ui-state-hover").addClass("ui-state-disabled"):a.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass("ui-state-default").removeClass("ui-state-disabled")},_getLayers:function(a){var d;d=b.data(a[0],"layers");if(typeof d=="undefined"){d=a.attr("name").split("_"); d=d[d.length-1]||"";d=a.closest(".ui-keyboard-row").find(".ui-keyboard-button[name$=_"+d+"]").map(function(){return this.value}).get();b.data(a[0],"layers",d)}return d},_hide:function(){b(".ui-keyboard").hide();this.element.scrollTop(this.element.attr("scrollHeight"))},_buildKeyboard:function(){var a,d,q,n,p,e,j,k,f,c=this,g=c.options,i=b("<div />").addClass("ui-keyboard ui-widget-content ui-widget ui-corner-all ui-helper-clearfix ui-helper-hidden-accessible").attr({role:"textbox"}).hide(),h=c.element.clone().removeAttr("id").attr(g.lockInput? {readonly:"readonly"}:{}).addClass("ui-widget-content ui-keyboard-preview ui-corner-all").bind("keyup",function(){g.useCombos&&b(this).val(c._checkCombos(b(this).val()))}),u=b("<input />").attr({type:"button",role:"button","aria-disabled":"false"}).addClass("ui-keyboard-button ui-state-default ui-corner-all"),m=function(l,o,v,r){o=r===true?l:g.display[o]||l;var t=o.length>1?" ui-keyboard-widekey":"";t+=r!==true?" ui-keyboard-actionkey":"";return u.clone().attr("name","key_"+l).data("keyaction",v).data("original", o).val(o).addClass("ui-keyboard-"+(r===true?l.charCodeAt(0):l)+t)},s=["ui-keyboard-default","ui-keyboard-shifted","ui-keyboard-alted","ui-keyboard-altshift"];b("<div />").append(h).appendTo(i);if(g.layout=="custom")c.layouts.custom=g.customLayout||[["{cancel}"]];g.display.decimal=".";for(d in c.layouts[g.layout]){q=c.layouts[g.layout][d];n=b("<div />").addClass("ui-keyboard-row ui-keyboard-row"+d).appendTo(i);for(p in q){e=b("<div />").addClass("ui-keyboard-keyset "+s[p]).appendTo(n)[p=="0"?"show": "hide"]();a=b.trim(q[p]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");k=a.split(/\s+/);for(j in k)if(k[j].length!==0)if(/^\{\S+\}$/.test(k[j])){a=k[j].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/^sp:(\.?\d+)$/.test(a)){f=a.match(/^sp:(\.?\d+)$/)[1]||0;b("<span>&nbsp;</span>").css("margin","0 "+f+"em").appendTo(e)}switch(a){case "a":case "accept":m("accept",a,function(){var l=h.val();if(g.useCombos)l=c._checkCombos(h.val());c.element.val(l);c._hide()}).addClass(g.actionClass).appendTo(e);break; case "alt":case "altgr":m("alt","alt",function(){c.altActive=!c.altActive;var l=c.altActive?"addClass":"removeClass",o=c.shiftActive?1:0;o+=c.altActive?2:0;i.find(".ui-keyboard-alt")[l]("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find("."+s[o]).show()}).appendTo(e);break;case "b":case "bksp":m("bksp",a,"bksp").appendTo(e);break;case "c":case "cancel":m("cancel",a,function(){c._hide()}).addClass(g.actionClass).appendTo(e);break;case "clear":m("clear","clear",function(){h.val("")}).appendTo(e); break;case "dec":m("decimal","decimal",".").appendTo(e);break;case "e":case "enter":m("enter",a,"\n").appendTo(e);break;case "s":case "shift":m("shift",a,function(){c.shiftActive=!c.shiftActive;var l=c.shiftActive?"addClass":"removeClass",o=c.shiftActive?1:0;o+=c.altActive?2:0;i.find(".ui-keyboard-shift")[l]("ui-state-active").end().find(".ui-keyboard-keyset").hide().end().find("."+s[o]).show()}).appendTo(e);break;case "sign":m("sign","sign",function(){/^\-?\d*\.?\d*$/.test(h.val())&&h.val(h.val()* -1)}).appendTo(e);break;case "space":m("space","space"," ").appendTo(e);break;case "t":case "tab":m("tab",a,"\t").appendTo(e)}}else m(k[j],k[j],k[j],true).attr("name","key_"+d+"_"+j).appendTo(e)}}return i}})})(jQuery);
